#!/usr/bin/env node
'use strict';

var _src = require('../src/');

var _src2 = _interopRequireDefault(_src);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _commander = require('commander');

var _commander2 = _interopRequireDefault(_commander);

var _updateNotifier = require('update-notifier');

var _updateNotifier2 = _interopRequireDefault(_updateNotifier);

var _package = require('../package.json');

var _package2 = _interopRequireDefault(_package);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var exitCode = 0;

process.on('uncaughtException', function (err) {
    console.error(err.stack);
    exitCode = 1;
});

process.on('exit', function () {
    process.exit(exitCode);
});

(0, _updateNotifier2.default)({ pkg: _package2.default }).notify({ defer: false });

var locateSeyFile = function locateSeyFile(options) {
    if (options.file === undefined) {
        return _path2.default.join(process.cwd(), 'seyfile.js');
    }

    if (!_path2.default.isAbsolute(options.file)) {
        return _path2.default.join(process.cwd(), options.file);
    }

    return options.file;
};

_commander2.default.version(_package2.default.version).description(_package2.default.description);

_commander2.default.command('init').description('initializes a sey file').option('-f, --file <seyfile.js>', 'loads specified sey file').action(function (options) {
    var seyfile = locateSeyFile(options);
    _src2.default.initFile(seyfile);
});

_commander2.default.command('clean').description('cleans temporary files in working directory').action(function () {
    _src2.default.clean();
});

_commander2.default.command('self-check').description('checks sey\'s self integrity.').action(function () {
    _src2.default.selfCheck();
});

_commander2.default.command('build').description('starts build').option('-np, --nopartial', 'disables partial building').option('-f, --file <seyfile.js>', 'loads specified sey file').action(function (options) {
    var seyfile = locateSeyFile(options);

    global.sey = _src2.default;
    require(seyfile);
});

_commander2.default.cli = true;
_commander2.default.parse(process.argv);
